# PRレビュー - 包括的なコードレビュー実行

指定されたPull Requestを詳細にレビューし、改善提案を行います。

## 使用方法
`/pr-review <PR番号またはURL>`

例:
- `/pr-review 123`
- `/pr-review https://github.com/owner/repo/pull/123`

## 実行手順

### 1. PR情報の取得と検証
- `gh pr view <PR番号> --json` でPR詳細情報を取得
- タイトル、説明、作成者、ステータスを確認
- ターゲットブランチとソースブランチの確認
- 認証エラー時はフォールバック処理を実行

### 2. 変更内容の分析
- `gh pr diff <PR番号>` で差分を取得
- 変更されたファイル一覧を取得 (`gh pr view --json files`)
- 追加・削除された行数の統計情報を収集
- コミット履歴の確認 (`gh pr view --json commits`)

### 3. コードレビューの実施

#### 3.1 自動チェック項目
- **コード品質**
  - 命名規則の一貫性
  - 重複コードの検出
  - 複雑度の評価
  - デッドコードの検出

- **セキュリティ**
  - ハードコードされた認証情報のチェック
  - SQLインジェクション脆弱性
  - XSS脆弱性の可能性
  - 適切な入力検証

- **パフォーマンス**
  - N+1クエリの検出
  - 非効率なループ処理
  - 不要な再レンダリング（フロントエンド）
  - メモリリークの可能性

- **保守性**
  - 適切なコメントの有無
  - エラーハンドリングの実装
  - ログ出力の適切性
  - テストの有無と品質

#### 3.2 プロジェクト固有のチェック
- プロジェクトのコーディング規約への準拠
- 既存のアーキテクチャとの整合性
- 依存関係の適切な管理

### 4. レビュー結果のフォーマット

#### 4.1 サマリー
- 全体的な評価（Approve/Request Changes/Comment）
- 主要な問題点の要約
- 良い点の強調

#### 4.2 詳細フィードバック
各ファイルごとに：
- 問題点の指摘（行番号付き）
- 改善提案と具体的なコード例
- 参考となるドキュメントやベストプラクティスへのリンク

#### 4.3 アクションアイテム
- 必須の修正項目（ブロッカー）
- 推奨される改善項目
- 将来的な改善提案

### 5. GitHub上でのコメント投稿（オプション）
- `gh pr comment` を使用してレビューコメントを投稿
- 行単位のインラインコメント
- 全体的なレビューコメント

## エラーハンドリング

### GitHub CLI認証エラー
プライベートリポジトリで認証エラーが発生した場合：
1. エラーメッセージを表示
2. 手動でPRを確認するためのURLを提供
3. 認証の再設定方法を案内：
   - `gh auth refresh -s repo,read:org`
   - GITHUB_TOKEN環境変数の確認

### API制限
- レート制限に達した場合の待機処理
- 部分的な結果での続行オプション

## 設定オプション
- `--format`: 出力形式（markdown/json/html）
- `--severity`: レビューの厳密さ（strict/normal/lenient）
- `--focus`: 特定の観点に絞る（security/performance/style）
- `--no-comment`: GitHubへのコメント投稿をスキップ

## 前提条件
- GitHub CLIがインストールされ認証済みであること
- 対象リポジトリへの読み取りアクセス権限
- PR番号またはURLが有効であること