# PRゼロからワークフロー

新規ブランチ作成からPR作成までを一連で実行する。

## 使用方法
```
/pr-zero [--from-main]
```
- `--from-main`: メインブランチから新規ブランチ作成
- 省略時: 現在のブランチから新規ブランチ作成

## 重要ルール
**既存ブランチには絶対にpushしない。必ず新規ブランチを作成する。**

## 手順
1. 新規ブランチ作成（Conventional Branch形式）
   - 例: `feature/admin-user-role-edit-invite-form`
2. `git status`、`git diff` で変更確認
3. コミット分割・作成（Conventional Commits形式）
4. `git push -u origin <branch>` でプッシュ
5. PRテンプレート確認（`.github/PULL_REQUEST_TEMPLATE.md`等）
6. `gh pr create --draft` でドラフトPR作成

## エラーハンドリング
- 認証エラー時は手動PR作成URLを提供
- `gh auth refresh -s repo,read:org` で再認証案内

## 絶対に守るべきルール
- 関係のない変更はコミットに含めない
- 関係のない変更を消さない
- `git checkout`、`git restore`、`git reset`、`git stash` は使わない（ブランチ作成時の明示的stashは除く）

---

改善して Network request outside of sandbox

   Host: github.com

   Do you want to allow this connection?
     1. Yes
   ❯ 2. Yes, and don't ask again for github.com
     3. No, and tell Claude what to do differently (esc)

      Network request outside of sandbox

   Host: api.github.com

   Do you want to allow this connection?
     1. Yes
   ❯ 2. Yes, and don't ask again for api.github.com
     3. No, and tell Claude what to do differently (esc)

---

これは？⏺ Bash(git add commands/ci-fix.md commands/commit-split.md commands/commit.md commands/pr-fix.md commands/pr-review.md
      commands/pr-zero.md commands/review-diff.md comm…)
  ⎿  Error: Exit code 1
     (eval):1: can't create temp file for here document: operation not permitted
     Aborting commit due to empty commit message.

---

# コミットコマンド

現在の変更をコミットし、リモートにプッシュする。

## 使用方法
```
/commit
```

## 手順
1. `git status` で変更を確認
2. Conventional Commits形式でコミットメッセージ作成
3. `git push` でリモートに反映

## Conventional Commits形式
- `type(scope): subject`
- タイトルは50文字以内、本文は72文字で改行
- 動詞は原形（add, fix, update等）
- scopeは原則記述、適切なものがなければ省略可
- 小文字で始める
- 実装とテストが含まれる場合、typeはfeat/fixを優先

## 絶対に守るべきルール
- 関係のない変更はコミットに含めない
- 関係のない変更を消さない
- `git checkout`、`git restore`、`git reset`、`git stash` は使わない

---

# PR自動修正コマンド

PRのレビューコメントとCIエラーを自動修正する。

## 使用方法
```
/pr-fix [pr番号]
```
PR番号省略時は現在のブランチのPRを使用。

## 修正対象
### レビューコメント
- 必ず修正: セキュリティ、バグ、型エラー、パフォーマンス問題
- それ以外: 内容を読み、修正すべきかを判断する

### CIエラー
- lint/type/test/build エラーを自動修正

## 手順
1. PR番号が指定されていない場合は `gh pr view` (引数なし)で現在のブランチのPRを取得。指定されている場合は `gh pr view <番号>` でPR情報取得
2. `gh api pulls/:pr/comments` でレビューコメント取得
3. コンフリクト確認、あれば解消
4. `gh pr checks` でCIエラー確認
5. ユーザーに修正方針を確認（AskUserQuestion）
6. 各レビューコメント修正について:
   a. 修正を適用
   b. コミット・プッシュ
   c. ボットコメントに返信（人間のコメントには返信しない）
7. CIエラー修正を適用
8. コミット・プッシュ
9. CLAUDE.md更新が必要か確認

## ユーザー確認（AskUserQuestion）

### 全体の修正方針
検出された修正項目について確認:
- **AIに判断を任せる（推奨）**: セキュリティ・バグ・型エラー・パフォーマンス問題は必ず修正、それ以外は内容を読んで判断
- **個別に選択する**: 各項目について個別に確認

### 個別選択の場合
各項目について確認:
- **AIに判断を任せる**: この項目についてAIが対応要否を判断
- **修正する**: この項目を修正対象に追加
- **修正しない**: この項目をスキップ

### CLAUDE.md更新確認
修正後、プロジェクト全体に適用すべきルールがあれば確認:
- セキュリティパターン、コーディング規約、繰り返し発生するエラーパターン等

## 自動返信ルール
- 修正した: `Done. <コミットURL>`
  - コミットURL形式: `https://github.com/{owner}/{repo}/commit/{sha}`
- 対応不要と判断: `Skipped: [理由]`

---

cliが正しい